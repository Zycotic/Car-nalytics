{% extends 'template.html' %}
{% block breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
    <li class="breadcrumb-item text-sm">
      <a class="opacity-5 text-dark" href="javascript:;">Pages</a>
    </li>
    <li class="breadcrumb-item text-sm text-dark active" aria-current="page">
      History
    </li>
  </ol>
  <h2 class="font-weight-bolder mb-0">History</h2>
</nav>
{% endblock %}

{% block title %}History{% endblock %}

{% block page1 %}active{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  {% for j in date %}
  <div class="col-12 mt-4">
    <div class="card mb-4">
      <div class="card-header pb-0 p-3">
        <h3 class="mb-1">History {{j.replace('-','/')}}</h3>
        <p class="text-sm">Detected Brand and Segmented image</p>
      </div>
      <div class="card-body p-3">
        <div class="row">
          {% for i in files %}
            {# i is now a path like uploads/user_<user_id>/<timestamp>/original.jpg #}
            {% set parts = i.split('/') %}
            {% set user_dir = parts[1] %}
            {% set timestamp = parts[2] %}
            {% set original_filename = parts[-1] %}
            
            {% if timestamp.split('_')[0] == j %}
            <div class="col-xl-3 col-md-6 mb-xl-0 mb-4 mt-2 align-self-end">
              <div class="card card-blog card-plain justify-content-between">
                <div class="position-relative">
                  <a href="{{ url_for('car', filename=timestamp) }}" class="d-block shadow-xl border-radius-xl">
                    {# Construct path to sementic.jpg using the timestamp #}
                    <img src="{{ url_for('static', filename='uploads/' + user_dir + '/' + timestamp + '/sementic.jpg') }}"
                         alt="img-blur-shadow"
                         class="img-fluid shadow border-radius-xl" />
                  </a>
                </div>
                <div class="card-body px-1 pb-0 d-inline-block text-truncate mt-auto">
                  <p class="text-gradient text-dark mb-2 text-sm">Original Filename</p>
                  {# Display the original filename #}
                  <a href="{{ url_for('car', filename=timestamp) }}">
                    <h5>{{ original_filename }}</h5>
                  </a>
                  <div class="d-flex align-items-center justify-content-center">
                    {# Link to the car route using the timestamp #}
                    <a href="{{ url_for('car', filename=timestamp) }}"
                       class="btn btn-outline-primary btn-sm mb-3">
                      Open Details
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
 