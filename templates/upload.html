{% extends 'template.html' %} {% block breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
    <li class="breadcrumb-item text-sm">
      <a class="opacity-5 text-dark" href="{{ url_for('index') }}">Pages</a>
    </li>
    <li class="breadcrumb-item text-sm text-dark active" aria-current="page">
      Home
    </li>
  </ol>
  <h2 class="font-weight-bolder mb-0">Home</h2>
</nav>
{% endblock %} {% block title %} Upload {% endblock %} {% block page2 %} active
{% endblock %} {% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow border-0">
        <div class="card-body p-4">
          <h3 class="mb-3 text-center">Upload a Car Image</h3>
          <form id="uploadForm" method="POST" action="" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="file" class="form-label">Choose an image or drag & drop below</label>
              <div id="drop-area" class="border border-2 border-primary rounded-3 p-4 text-center bg-light" style="cursor:pointer;">
                <i class="fa fa-cloud-upload fa-3x mb-2 text-primary"></i>
                <p class="mb-2">Drag & drop an image here, or click to select</p>
                <input type="file" class="form-control d-none" id="file" name="file" accept="image/*" multiple required>
                <div id="preview" class="mt-3"></div>
              </div>
            </div>
            <div class="mb-3">
              <div class="progress d-none" id="progressBarContainer">
                <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar" style="width: 0%"></div>
              </div>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg"><i class="fa fa-upload me-2"></i>Upload</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
// Drag & Drop logic
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const form = document.getElementById('uploadForm');
const progressBar = document.getElementById('progressBar');
const progressBarContainer = document.getElementById('progressBarContainer');

dropArea.addEventListener('click', () => fileInput.click());
dropArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropArea.classList.add('bg-primary', 'text-white');
});
dropArea.addEventListener('dragleave', (e) => {
  e.preventDefault();
  dropArea.classList.remove('bg-primary', 'text-white');
});
dropArea.addEventListener('drop', (e) => {
  e.preventDefault();
  dropArea.classList.remove('bg-primary', 'text-white');
  if (e.dataTransfer.files.length) {
    fileInput.files = e.dataTransfer.files;
    showPreview(e.dataTransfer.files);
  }
});
fileInput.addEventListener('change', (e) => {
  if (fileInput.files.length) {
    showPreview(fileInput.files);
  }
});
function showPreview(files) {
  preview.innerHTML = '';
  Array.from(files).forEach(file => {
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'img-fluid rounded shadow m-1';
        img.style.maxHeight = '120px';
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    }
  });
}
// Progress bar simulation for multiple files
form.addEventListener('submit', function(e) {
  if (fileInput.files.length) {
    progressBarContainer.classList.remove('d-none');
    let width = 0;
    progressBar.style.width = '0%';
    progressBar.innerText = '0%';
    const interval = setInterval(() => {
      if (width >= 100) {
        clearInterval(interval);
      } else {
        width += 10;
        progressBar.style.width = width + '%';
        progressBar.innerText = width + '%';
      }
    }, 100);
  }
});
</script>
{% if filename %}
<div class="row mt-4">
  <h4>
    Result : {% if logo %} Car brand
    <span class="badge bg-primary">{{logo}}</span> {% endif %}
  </h4>
  {% for i in ['Logo','Original','Sementic','Mask'] %}
  <div class="col-md-3 mt-4">
    <div class="card">
      <div class="card-header p-0 mx-3 mt-3 position-relative z-index-1">
        <a
          href="{{ url_for('static', filename='uploads/' + filename + '/' + i + '.jpg') }}"
          class="d-block"
        >
          <img
            src="{{ url_for('static', filename='uploads/' + filename + '/' + i + '.jpg') }}"
            class="img-fluid border-radius-lg"
          />
        </a>
      </div>

      <div class="card-body pt-2">
        <span
          class="text-gradient text-primary text-uppercase text-xs font-weight-bold my-2"
          >{{filename}}</span
        >
        <a href="javascript:;" class="card-title h5 d-block text-darker">
          {{i}}
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
  <div class="d-flex justify-content-center col-12 mt-4">
    <a
      href="{{ url_for('car',filename=filename.split('.')[0] ) }}"
      class="btn btn-outline-primary btn-sm mb-3"
      >View more</a
    >
  </div>
</div>
{% endif %}
{% if processed %}
<div class="row mt-4">
  <h4>Batch Upload Results</h4>
  {% for item in processed %}
  <div class="col-md-4 mt-4">
    <div class="card">
      <div class="card-body text-center">
        <img src="{{ url_for('static', filename='uploads/' + item.timestamp + '/original.jpg') }}" class="img-fluid rounded shadow mb-2" style="max-height:150px;" />
        <h5 class="mb-1">{{ item.filename }}</h5>
        <span class="badge bg-primary">Brand: {{ item.logo }}</span>
        <a href="{{ url_for('car', filename=item.timestamp) }}" class="btn btn-outline-primary btn-sm mt-2">View Details</a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %} {% endblock %} {% block js %}
<script type="text/javascript">
  function loading() {
    document.getElementById("sub").style.display = "none";
    document.getElementById("loading").style.display = "block";
  }
</script>
{% endblock %} {% block toasts %}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="toast align-items-center text-bg-{{ 'success' if category == 'success' else 'danger' if category == 'error' else 'info' }} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
          <div class="d-flex">
            <div class="toast-body">
              {{ message }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
{% endblock %}
